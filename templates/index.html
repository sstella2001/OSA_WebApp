<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSA Webapp</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/styles.css">
    <link rel="shortcut icon" href="../static/OSA.png">
  </head>
  <body>

    <div id="upper" class="row">

      <div id="plot" class="col-sm-10">
        <iframe id="graph" src="/graph" height="100%" width="90%"></iframe>
      </div>

      <div id="tools" class="col-sm-2">
        <form method="get" id="execute">
          <button id="start" type="submit">Start</button></br></br>
          <label for="dropdown">Collection:</label>
          <select name="dropdown" id="dropdown">
              <option value="real-time">Real-time</option>
              <option value="single">Single</option>
          </select>
        </form>
      </div>
    </div>

    <div id="lower" class="row">
      <div class="row">
        <div id="search" class="col">
          <form method="get" id="cmd">
            <label for="command">Command</label>
            <input type="text" name="command" id="command" placeholder="(e.g: LIM/[1550, 1570])">
            <button id="send" type="submit">Send</button>
          </form>
        </div>
    </div>

      <div class="row">
        <div id="output" class="col">
        </div>
      </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript">

    document.getElementById("start").addEventListener("click", click);
    document.getElementById("send").addEventListener("click", send);

    function click(e){
      e.preventDefault(e);
      if($("#dropdown").val() == "real-time" && $("#start").html() == "Stop"){
        $("#start").css("background-color", "green");
        $("#start").html("Start");
        $("#dropdown").prop("disabled", false);
      }else if($("#dropdown").val() == "real-time" && $("#start").html() == "Start"){
        $("#start").css("background-color", "red");
        $("#start").html("Stop");
        $("#dropdown").prop("disabled", true);
        fetch();
      } else {
        $.ajax({
          type:'GET',
          url:'/single'
        });
      }
    }

    function fetch(){

      if($("#dropdown").val() == "real-time" && $("#start").html() == "Start"){
        $.ajax({
          type:'GET',
          url:'/fetch/stop'
        });
      }else if($("#dropdown").val() == "real-time" && $("#start").html() == "Stop"){
        $.ajax({
          type:'GET',
          url:'/fetch/start',
          success: function(){
            try {
              setTimeout(fetch, 1000);
            } catch(err) {
              $("#start").css("background-color", "green");
              $("#start").html("Start");
              $("#dropdown").prop("disabled", false);
              console.log("Time limit exceed");
            }
          }
        });

      }
    }

    function send(e){
      e.preventDefault(e);
          $.ajax({
            type:'GET',
            data:{
              command:$("#command").val()
            },
            url:'/cmd',
            success: function(response) {
              $("#output").html(response);
            }
          });
    }
    </script>
  </body>
</html>
